<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sharing TMI News</title>

<script>
  // Get the story ID from URL
  const params = new URLSearchParams(window.location.search);
  const storyId = params.get('id');

  // Default OG values
  let ogTitle = "TMI News — Tech. Magic. Innovation";
  let ogDescription = "Check out this amazing tech story on TMI News!";
  let ogImage = "https://placehold.co/900x500?text=TMI+News";
  let redirectUrl = "/news.html";

  // Fetch news.json to find the story
  fetch('/news.json')
    .then(res => res.json())
    .then(data => {
      const story = data.stories.find(s => s.id === storyId);
      if(story){
        ogTitle = story.headline;
        ogDescription = story.preview + " Read full story on our site.";
        ogImage = story.image;
        redirectUrl = `/news.html#${storyId}`;
      }

      // Inject OG/meta tags dynamically
      const head = document.head;

      const metaTags = [
        {property:"og:title", content:ogTitle},
        {property:"og:description", content:ogDescription},
        {property:"og:image", content:ogImage},
        {property:"og:type", content:"article"},
        {name:"twitter:card", content:"summary_large_image"},
        {name:"twitter:title", content:ogTitle},
        {name:"twitter:description", content:ogDescription},
        {name:"twitter:image", content:ogImage}
      ];

      metaTags.forEach(tag=>{
        const el = document.createElement('meta');
        if(tag.property) el.setAttribute('property', tag.property);
        if(tag.name) el.setAttribute('name', tag.name);
        el.setAttribute('content', tag.content);
        head.appendChild(el);
      });

      // Redirect after a short delay (so social apps can fetch OG)
      setTimeout(()=>{ window.location.href = redirectUrl; }, 100);
    })
    .catch(err=>{
      console.error("Failed to load news.json for share page", err);
      setTimeout(()=>{ window.location.href = redirectUrl; }, 100);
    });
</script>
</head>
<body>
<p>Redirecting to the story…</p>
</body>
</html>
